{% extends 'layout.html' %}

{% block title %}Modificar Comida{% endblock %}

{% block body %}

<a href="{{ url_for('paciente.inicio', id=get_pac.id_paciente) }}">Volver</a>
  <h1>Modificar Comida</h1>

<form action="{{ url_for('paciente.updateFood', id=get_pac.id_paciente, date=date) }}" method="POST" class="form-control">
    
    <div class="form-group">
        <label>Fecha</label>
        {{ date_formatted }}
    </div>

    <div class="form-group">
        <label>Tipo de Comida</label>
        <div required>
        <label><input type="radio" name="tipo-comida" value="D" {% if datos[0].tipo == "D" %} checked {% endif %}>Desayuno</label></input><br>
        <label><input type="radio" name="tipo-comida" value="A" {% if datos[0].tipo == "A" %} checked {% endif %}>Almuerzo</label></input><br>
        <label><input type="radio" name="tipo-comida" value="C" {% if datos[0].tipo == "C" %} checked {% endif %}>Cena</label></input><br>
        <label><input type="radio" name="tipo-comida" value="M" {% if datos[0].tipo == "M" %} checked {% endif %}>Merienda</label></input><br>
        </div>
    </div>

    <!-- Alimentos -->
    <div class="alimentos" id="alimentos">
        <div class="row group">
            <div class="column">
                <div class="form-group">
                    <label>Alimento</label>
                    <select id="alimentos-select" name="alimentos[]">
                        <option value="">Selecciona el nombre</option>
                        {% for alimento in get_ali %}
                            <option value="{{ alimento.id_alimento }}">{{ alimento.nombre }}</option>
                        {% endfor %}
                    </select>
                    <button type="button" id="add-alimento">Agregar otro Alimento</button>
                </div>
            </div>
        </div>
        <ul id="selected-alimentos">
            {% for alimento in selected_alimentos %}
                <li data-id="{{ alimento.id_alimento }}">
                    {{ alimento.nombre }}
                    <button type="button" class="remove-alimento">Eliminar</button>
                </li>
            {% endfor %}
        </ul>
    </div>
    <!-- -- -->

    <label for="satisfaccion">Satisfacci√≥n</label>
    <input type="text" id="satisfaccion" name="satisfaccion" value="{{ datos[0].satisfaccion if datos else '' }}" required><br>

    <label for="comentario">Comentario</label>
    <textarea id="comentario" name="comentario" required>{{ datos[0].comentario if datos else '' }}</textarea><br>

    <button type="submit">Guardar Cambios</button>
</form>

<!-- ZONA DE SCRIPTS -->
<script>

// Para que funcione la entrada multiple de datos en alimento
document.getElementById('add-alimento').addEventListener('click', function() {
    var select = document.getElementById('alimentos-select');
    var selectedValue = select.value;
    var selectedText = select.options[select.selectedIndex].text;

    if (selectedValue) {
        var ul = document.getElementById('selected-alimentos');
        var li = document.createElement('li');
        li.setAttribute('data-id', selectedValue);
        li.innerHTML = selectedText + ' <button type="button" class="remove-alimento">Eliminar</button>';
        ul.appendChild(li);

        // Clear the selection
        select.value = '';
    }
});

document.getElementById('selected-alimentos').addEventListener('click', function(e) {
    if (e.target && e.target.classList.contains('remove-alimento')) {
        var li = e.target.parentElement;
        li.parentElement.removeChild(li);
    }
});
// // 

</script>
<!-- // SCRIPTS -->

{% endblock %}